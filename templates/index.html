<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>YOLO Detection</title>
</head>
<body>
    <h1>YOLO Person Detection</h1>

    <div>
        <label>Камера:</label>
        <select id="cameraSelect"></select>
        <button onclick="changeCamera()">Выбрать</button>
    </div>

    <div>
        <img id="videoStream" src="/api/video/feed" width="640" height="480">
    </div>

    <div>
        <h2>Отправить координаты смещения</h2>
        <input type="number" id="coordX" placeholder="X">
        <input type="number" id="coordY" placeholder="Y">
        <button onclick="sendCoordinates()">Отправить</button>
    </div>

    <p id="status"></p>

    <script>
        async function loadCameras() {
            const res = await fetch('/api/video/cameras');
            const cameras = await res.json();
            const select = document.getElementById('cameraSelect');
            cameras.forEach(cam => {
                const option = document.createElement('option');
                option.value = cam.id;
                option.textContent = cam.name;
                select.appendChild(option);
            });
        }

        async function changeCamera() {
            const cameraId = parseInt(document.getElementById('cameraSelect').value);
            await fetch(`/api/video/select_camera/${cameraId}`, {method: 'POST'});
        }

        async function sendCoordinates() {
            const x = document.getElementById('coordX').value;
            const y = document.getElementById('coordY').value;

            if (!x || !y) {
                document.getElementById('status').textContent = 'Введите X и Y';
                return;
            }

            const res = await fetch('/api/coords/send', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({x: parseInt(x), y: parseInt(y)})
            });

            const data = await res.json();
            document.getElementById('status').textContent =
                `Исходные: X=${data.original.x}, Y=${data.original.y}. Смещение: X=${data.modified.x}, Y=${data.modified.y}`;
        }

        window.onload = loadCameras;
    </script>
</body>
</html>
